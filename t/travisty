#!/bin/sh

mkdir -p tmp/$TRAVIS_REPO_SLUG/$TRAVIS_BUILD_NUMBER/$TRAVIS_JOB_NUMBER
cp -R coverage/* tmp/$TRAVIS_REPO_SLUG/$TRAVIS_BUILD_NUMBER/$TRAVIS_JOB_NUMBER
(cd tmp && tar czvf ~/coverage.tar.gz $TRAVIS_REPO_SLUG)
echo "$TRAVISTY_KEY" >> ~/.passphrase.txt
base64 --decode << '__EOM__' > ~/id_travisty.gpg
jA0ECQMC/lEsX+76jixg0uoBFEWaoMJfazGpF5QkM79uJMCQVnB9bEWAvsNtubpqxp/JNGgD3yzY
XiGAvw+fhyzclvzs8YFZxcmUx5qRlycvt9Jprpg85S2HrbDi9DgQzwX1iR8y/JM+9X14n8+ER6MJ
7v5Rza1mMs+fcfZ2I3jdnMVyQyaCp+F2u4xlWAtfb7eywfk5He5NFhNFQ2n09u1zF3ySH+m6IMrs
WkJPfCt4Il1/wChuaugATnby6M7D4g0gXIay6015WB1sdzEwToB3xuZ8hZO5Lfw6gguvd7eriJAa
YaQ3MyTwYmBWNmeV6naz3RH6DMBhg8oLxTwq1DqZK7q82IY3qUbme7ICthzNiOucwAOXu4Spt1Wg
9ePmDpc2mPvwOEwKtDAdjg8J+otfbrVEQVYXFvpVdowbIebug4swF4YYqcQ8qCXvDzTZ8KMk6kXW
3/dJekIa22Gge/sCECnjpCgrYqj9xUVSKOvr/tpP7vynhSCuBfYMriDHEBzNFnFj9bMhtzv7DrD5
YnMgK8yR+OI7LJrPfuZPCphVYyMqkBhay3fPKpc3pWwMZq6MQYQbb66/xI81BpArTGlqglgHuVYH
sfjMWH+iTDDGfBQ8Zf92mGdvc8fIe7Gio4s+2XHXoqu5cw25emopSgx6pdZ9sUGh3repZm8Vfd3l
/2f/JAng2JcMmrFfvCkTQmdLvKYDDf77YfvZjCzadoa/PHVoFdpbCtfEoSFlnmKXfW7kQ2N8xVUP
tQd9C96aJ7V8OJIDO46fncZUm7HaabYJsOYaC4JUX+PmJOY+pJVasOO8MzB5iSo8vzDNMzg0wvkT
3emt0tf7zdUifEOC9KOa77JzEywjWmH2CoFM3JS/vWVQXpVxy25YN07eMrBAKBSMI+UM5KutDcS4
fhN4qNZWdtGl4MT5iJZI0K9lnGonbnSv/7gCtDyVCejViULG7Afg/OAOaggFzKl1r1q52hVDYSza
/Od/1xnhxBFK0gsxjuJI/Fd9ZoPLJ134mA+13avZbWD6WGfdDkmlG84ZiydnyZhRx949xiDFITdK
AIGea9s64MJyRGsHbIqt4owy1GzD5en5xCsze/54H1eb9wV/N0XPOhVv/jdR4y8ju8XJFJyeZaN6
DjYkNSaqnktZAlPScb4TvjsNcpfJpRry1kKE+rVsoQ86xELbDQTpfY3AkH/UZ4HsB8vLo3QtgtHc
jm6yLc8gigS6NzPGasK3Mogu37cniD/U2vGWs0Ipy297NU/gIpj6+jncj6Dz58r/DpNGAjH90xwp
fwu0VjmJro2euH0dx64zg5Ao8UsFC7cmDdJO6mYQCpGjZ0eBNI45wDBz3cht3LcidD0tSKNCPbyb
SsGSZ25kymt+XQ9uTQBawIkUrANX5kc2lQlyLOX4//9POkgxIUI5MFV9paf792giG1OpjWd2fZrl
mfAiDL2E3tvAIxZdKTTsfwLL1sZU2WJcwXeaMA2o8KzhixSYikPb3dGQiItRpdFjvJMa32HazLj1
JivhM1eASos/cH9gGbbsmM/nlwIV19KQivPbjOO0MLMtlgpSqu+V2ZhezXa59aHsv2ngrX4NE64m
bOBqc3C2idI/oULAwACT8fdTILYLMQAyoe+osflF/JX+/EHyo4vBuy2jfDC0ICT1GQqGOwB+XFtf
5TfO1OOeJapRtHiaP4DVt0ppYkMJ9h8xquXOxqYYbb7Mfi20UF2w15dfxDsd/GblqmV95KQs4GSv
OJ2eFn+IFe9seroMDQZtqA0p5dA+cq8Qrtfcct2yjIpAN81Kt5AqsgbwAuvVopYGF3018+uoGlBM
7yR5Uw==
__EOM__
gpg --passphrase-file ~/.passphrase.txt --decrypt t/id_travisty.gpg > ~/.ssh/id_travisty
base64 --decode << '__EOM__' >> ~/.ssh/known_hosts
cHJldHR5cm9ib3RzLmNvbSBzc2gtcnNhIEFBQUFCM056YUMxeWMyRUFBQUFEQVFBQkFBQUJBUUN5
UjRZRlVwaklVN1czbTFlUHU5T2N2L0x1QVp0UlQ1eWdFNTM2MGwzMjArVFNjMVp2V01TZ0RRWUMr
RXRkODhFaC9tSlR1aTJBbTJlekdKU2dzc0htY3FuVk5EUm9iY3ZZU2RPN0JScXZoWkNvUmtNQkNY
bENmZUV4Q2h6M2pJQWlZV0dhMEN2YmJ0ZjNQWFpCUFdnVjNLeC83enpaazhIUElCaUZtTmFHdU5G
eXJTZWJ4WmpKMmlWNEhnUWxLYmkvNWk4Ykw5S1RYbEZoL21MQ3J2WFJtVURWNndqSlZiRXpCRTNW
ejRod3VJRmZiREE3ZzVlK2xyOWpUelpPMVNoVitnQlZVaTNxZGU4bjVTczgrVmgxMHRsYWxOZGh0
Z3o0SDBMSWcxQTA1UFBvRWpPT2xzZitaeGdnT1cvVU1VQTVvWXNlUTBqcFpxMzVYb3BqdVZqNwo=
__EOM__
ssh -i ~/.ssh/id_travisty alan@prettyrobots.com /home/alan/travisty < ~/coverage.tar.gz
